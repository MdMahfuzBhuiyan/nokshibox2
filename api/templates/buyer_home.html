{% extends 'base.html' %}

{% block title %}Buyer Home - NokshiBox{% endblock %}

{% block nav_items %}
<li class="nav-item"><a class="nav-link" href="{% url 'buyer_home' %}">Home</a></li>
<li class="nav-item"><a class="nav-link" href="#">Products</a></li>
<li class="nav-item"><a class="nav-link" href="#">About Us</a></li>
<li class="nav-item"><a class="nav-link" href="#">Contact Us</a></li>
{% endblock %}

{% block content %}
<div class="row">
    <!-- Categories Sidebar -->
    <div class="col-md-3">
        <h5>Categories</h5>
        <ul class="list-group" id="category-list">
            <li class="list-group-item active" data-category="all">All</li>
            {% for category in categories %}
                <li class="list-group-item" data-category="{{ category.id }}">{{ category.name }}</li>
            {% endfor %}
        </ul>
    </div>

    <!-- Products + Search -->
    <div class="col-md-9">
        <!-- ðŸ” Search Bar (only here now) -->
        <div class="mb-3">
            <input 
                type="text" 
                id="searchBar" 
                class="form-control" 
                placeholder="Search products...">
        </div>

        <!-- Product Grid -->
        <div class="row" id="product-grid">
            {% for product in products %}
            <div class="col-md-4 mb-3 product-card" data-category="{{ product.category.id }}">
                <div class="card h-100">
                    <img src="{{ product.image.url }}" class="card-img-top" alt="{{ product.title }}">
                    <div class="card-body">
                        <h5 class="card-title">{{ product.title }}</h5>
                        <p class="card-text">${{ product.price }}</p>
                        <a href="{% url 'product_detail' product.id %}" class="btn btn-primary">View Details</a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Category Filter Script -->
<script>
document.querySelectorAll('#category-list li').forEach(item => {
    item.addEventListener('click', function() {
        document.querySelectorAll('#category-list li').forEach(li => li.classList.remove('active'));
        this.classList.add('active');
        let selected = this.dataset.category;
        document.querySelectorAll('.product-card').forEach(card => {
            card.style.display = (selected === 'all' || card.dataset.category === selected) ? 'block' : 'none';
        });
    });
});
</script>

<!-- Search Bar Script -->
<script>
document.getElementById('searchBar').addEventListener('keyup', function() {
    let searchValue = this.value.toLowerCase();
    let products = document.querySelectorAll('.product-card');

    products.forEach(product => {
        let title = product.querySelector('.card-title').innerText.toLowerCase();
        let price = product.querySelector('.card-text').innerText.toLowerCase();

        if (title.includes(searchValue) || price.includes(searchValue)) {
            product.style.display = "block";
        } else {
            product.style.display = "none";
        }
    });
});
</script>
{% endblock %}
